#Εργαστήριο ΛΣ 1/ Άσκηση 2 / 2020-21

#
#----------------------------------------
#
#Να γραφτεί scriptμε το όνομα teldbτο οποίο θα διαχειρίζεται μία βάση τηλεφωνικούκαταλόγου η οποία θα υλοποιείται στο αρχείο catalog. Το scriptθα πρέπει νακάνει τα εξής:
#1)Με την παράμετρο –a θα προσθέτει μια νέα εγγραφή στον κατάλογο(δηλαδή στο αρχείο catalog). 
#Η προσθήκη θα γίνεται αφού ζητήσει από τον χρήστη όνομα, επώνυμο, πόλη και η καταχώρησηθα τοποθετείται σε μία γραμμή (π.χ. John Markou Peristeri 2105546789).
#2)Με την επιλογή –l θα μας δείχνει τα περιεχόμενα του καταλόγου(με αριθμημένες τις γραμμέςτου και παραλείποντας τις τυχόν κενές γραμμές)
#3)Με  την επιλογή –s  ακολουθούμενη  από  έναν  αριθμό  θα  μας  δείχνει  τα  περιεχόμενα  του καταλόγου  ταξινομημένα  κατά  τη  στήλη  που  δηλώνει  ο  αριθμός  
#(π.χ.  το  telcat –s  3  θα εμφανίζει τα περιεχόμενα ταξινομημένα κατά πόλη).
#4)Με την επιλογή –c ακολουθούμενη από ένα keyword θα μας εμφανίζει μόνο τις γραμμές του καταλόγουπου περιλαμβάνουν το keyword.
#5)Με την επιλογή –d ακολουθούμενη από ένα keyword και–b ή –r, θα διαγράφει τις γραμμές του καταλόγουπου περιλαμβάνουν το keyword. 
#Αν η τρίτη παράμετρος είναι –b θα εισάγει στη θέση κάθε γραμμής που διαγράφει μία κενή ειδάλλως (–r) όχι .
#6)Με την επιλογή –n θα εμφανίζει τον αριθμότων κενώνγραμμών του καταλόγου, θα ζητάειαπό το χρήστη αν θέλει να διαγραφούν ή όχι και θα πράττει ανάλογα.
#Σε κάθε άλλη περίπτωση θα τυπώνεται το κατάλληλο μήνυμαχρήσης/καθοδήγησης (Usage).
#Επίσης αν στις παραμέτρους –c και –d δεν υπάρχουν γραμμές που να περιλαμβάνουν το keyword ο χρήστης να ειδοποιείται με το κατάλληλο μήνυμα.
#
#
#Απάντηση:
#!/bin/bash


echo -n "Choose one of the following options:
 -a Add a new name in the catalog.
 -l List all entries of the catalog.
 -s [NUMBER] Sort by number of your choice. 
 -c [KEYWORD] List all entries of the catalog that include a KEYWORD.
 -d [KEYWORD] and [-b or -r] Remove entries that include a KEYWORD. Option -b adds a blank line and -r doesn't. 
 -n Show amount of blank spaces
 -e Exit
 Choice: "

read choice choice2 choice3

case $choice in
-a)
	read -p 'Give the new catalog entry: ' newentry
	echo $newentry >> catalog
;;
-l)
	cat -b catalog
;;
-s)
	if [[ $choice2 = "" ]]; then 
		echo "Invalid entry"
		exit 1	
	fi

	sort -k $choice2 catalog	
;;
-c)
	if [[ $choice2 = "" ]]; then 
		echo "Invalid entry"
		exit 1	
	fi

	egrep $choice2 catalog

;;
-d)
	if [[ $choice2 = "" ]]; then 
		echo "Invalid entry"
		exit 1	
	fi	
	
	if (($choice3 == "-r")); then
		sed -i "/$choice2/d" catalog
	elif (($choice3 == "-b")); then
		sed -i "s/$choice2/\n" catalog
	else 
		echo "Invalid entry"
		exit 1
	fi
;;	
-n)
	egrep -cv '\S' catalog
	
	echo "Do you want to delete these lines?(Yes/No)"
	read answer
	if (($answer == "Yes")); then
		sed '/^$/d' catalog
	fi	
;;

*)
echo Exiting program
;;
esac
#
#
#Σχόλια: Όλες οι επιλογές είναι μέσα σε μια case αφού θέλουμε να φτιάξουμε ένα μενού. Η read διαβάζει εώς 3 μεταβλητές ανάλογα με το ερώτημα. Μέσα στην case ελέγχω πάντα 
#(εκτός από το πρώτο ερώτημα) αν το choice2 είναι κενό γιατί αν είναι τότε δεν θα λειτουργούν οι εντολές που ακολουθούν. Ελέγχω μόνο το choice2 και όχι και το choice3 γιατί
#στα Linux είναι αδύνατον να "προσπεράσουμε" μεταβλητές. Τουλάχιστον έτσι όπως το έχω γράψει δεν μπορούμε. Αν ο χρήστης πληκτρολογήσει κάτι άλλο άσχετο με τις επιλογές που του
#έχω δώσει τότε το script θα τερματιστεί. 
#
#Για το 1ο ερώτημα: Το read -p μου επιτρέπει να εμφανίσω και text αλλά και να διαβάσω την μεταβλητή newentry σε μια σειρά. Η ανακατεύθυνση αλλάζει το standard output της echo
#να γράφει το catalog επομένως προσθέτει το newentry στο catalog.
#
#Για το 2ο ερώτημα: Η cat -b εμφανίζει όλες τις γραμμές του catalog αλλά αριθμοί μόνο τις μη κενές. 
#
#Για το 3ο ερώτημα: Η sort -k ακολουθούμενη από ένα number (choice2) ταξινομεί ανά στήλη. 
#
#Για το 4ο ερώτημα: Η egrep βρίσκει όλα τα entries τα οποία έχουν το keyword που επέλεξε ο χρήστης.
#
#Για το 5ο ερώτημα: Εδώ ελέγχω το choice3 γιατί αν είναι οτιδήποτε άλλο εκτός απο -b και -r τότε δεν θα δουλέψει η sed. Η πρώτη sed διαγράφει την σειρά που περιέχει μέσα της
#το keyword ενώ η δεύτερη αντικαταστεί ολόκληρη την γραμμή με μια κενή δηλαδή ένα newline. 
#
#Για το 6ο ερώτημα: Για την grep:
#-c για να αριθμήσει τις γραμμές
#Για να καταλάβουμε τι κάνει το -v πρέπει να καταλάβουμε τι είναι το '\S'. Το \S είναι το συνώνυμο του [^[:space:]] δηλαδή μη κενές γραμμές. Το v επομένως αντιστρέφει αυτή την 
#κατάσταση και βρίσκει τις κενές γραμμές, αυτές δηλαδή που περιέχουν [[:space]].
#Μετά το script ρωτάει τον χρήστη αν θέλει να τις διαγράψει και με την βοήθεια μιας sed τις διαγράφει. 
