#Εργαστήριο ΛΣ 1/ Άσκηση 2 / 2020-21

#
#----------------------------------------
#
#Γράψτε ένα scriptμε όνομα bckτο οποίο θα κρατά για έναν συγκεκριμένο χρήστη (το usernameτου οποίου θα δίνεται ως πρώτο όρισμα) 
#εφεδρικά αντίγραφα μιας περιοχής του λογαριασμού του σε κάποια άλλη. Το script θα πρέπει να δέχεται ως δεύτεροόρισμα ένα κατάλογο (ή αρχείο)
#να δημιουργεί ένα προς αποθήκευση αντίγραφο του ορίσματος (χρήση tar) και να το αντιγράφει στον κατάλογο που ορίζει το τρίτοόρισμα. 
#Αν ωστόσο το τρίτο όρισμα είναι αρχείο (και όχι κατάλογος) τότε θα πρέπει απλά να προσθέτει (append)το προς αποθήκευση αντίγραφο στο αρχείο αυτό. 
#Κάντε τους απαραίτητους ελέγχους και για τα τρία ορίσματα(καθώς και για το συνολικό αριθμό των ορισμάτωνπου δόθηκαν κατά την εκτέλεση).
#
#Τροποποιήστε κατάλληλα το scriptbck(σε bck1)ώστε να πραγματοποιεί το ζητούμενο backup προγραμματισμένα (χρήση at)
#σε μια συγκεκριμένηώρα της επιλογής σας (προσπαθήστε να τη δίνετε και αυτήν σαν όρισμα)
#
#Τροποποιήστε κατάλληλα το scriptbck(σε bck2)ώστε να εκτελείται χωρίς ορίσματα και απλά να λαμβάνειαντίγραφο του καταλόγου εργασίαςσας στο /tmp
#και προγραμματίστε (χρήση cron) να τρέχει κάθε Κυριακή βράδυ στις 11μμ. για τους επόμενους έξιμήνες.
#
#Απάντηση:

#!/bin/bash

#Αντιστοιχώ τα ορίσματα στις κατάλληλες μεταβλητές 
username=$1
arg2=$2
arg3=$3

if [[ $username = "" || $arg2 = "" || $arg3 = "" ]]; then #Αν ένα από τα 3 είναι ίσο με το κενό τότε ο χρήστης δεν έχει δώσει αρκετά arguments
	echo "Insufficient arguments"
	exit 1
fi

var=$(who | egrep -c "$username") #Αν ο χρήστης υπάρχει το var=1 αν όχι τότε var=0 
if ((var == 0)); then
	echo "User not found"
	exit 1
fi

var1=$(find /home/$username -name $arg2) #Βρίσκω αν το αρχείο που έδωσε ο χρήστης ανήκει στον user
if [ -f  $var1 ]
then 
    echo "It's a file"
elif [ -d  $var1 ]
then
    echo "It's a directory"
else
    echo "This file/directory doesn't exist on this user"
    exit 1
fi

var2=$(find -name $arg3) #Βρίσκω που είναι το όρισμα 3
if [ -f ${arg3} ] #Αν είναι αρχείο
then 
    tar -rvf $var2 $var1 
elif [ -d ${arg3} ] #Αν είναι κατάλογος
then
    tar -cvf $var2/backup $var1 
else
    echo "This file/directory doesn't exist"
    exit 1
fi 
